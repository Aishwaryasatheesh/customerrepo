package com.customerpolicy.service;

import java.time.LocalDate;
import java.util.Date;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

import com.customerpolicy.entity.Customer;
import com.customerpolicy.entity.Purchased;
import com.customerpolicy.entity.PurchasedPolicy;
import com.customerpolicy.exception.CustomerNotFoundException;
import com.customerpolicy.exception.PolicyNotFoundException;
import com.customerpolicy.pojo.Policy;
import com.customerpolicy.pojo.PurchasePolicyRequest;
import com.customerpolicy.repository.CustomerRepository;
import com.customerpolicy.repository.PurchaseRepository;

import jakarta.transaction.Transactional;

@Service
public class PurchasePolicyService {
@Autowired
private PurchaseRepository purchasedRepository;
@Autowired
CustomerRepository customerRepository;
@Autowired
RestTemplate restTemplete;
}
@Transactional
public PurchasedPolicy purchasePolicy(Long policyId, Long customerId, Date maturityDate) {
    if (!isCustomerValid(customerId)) {
        throw new RuntimeException("Invalid customer ID");
    }

    if (!isPolicyValid(policyId)) {
        throw new RuntimeException("Invalid policy ID");
    }

    PurchasedPolicy purchasedPolicy = new PurchasedPolicy();
    purchasedPolicy.setPolicyId(policyId);
    purchasedPolicy.setCustomerId(customerId);
    purchasedPolicy.setPurchaseDate(new Date());
    purchasedPolicy.setMaturityDate(maturityDate);

    return purchasedPolicyRepository.save(purchasedPolicy);
}
