package com.customerpolicy.service;

import java.time.LocalDate;
import java.util.Date;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

import com.customerpolicy.entity.Customer;

import com.customerpolicy.entity.PurchasedPolicy;
import com.customerpolicy.exception.CustomerNotFoundException;
import com.customerpolicy.exception.PolicyNotFoundException;
import com.customerpolicy.pojo.Policy;
import com.customerpolicy.pojo.PurchasePolicyRequest;
import com.customerpolicy.repository.CustomerRepository;
import com.customerpolicy.repository.PurchaseRepository;

import jakarta.transaction.Transactional;

@Service
public class PurchasePolicyService {
@Autowired
private PurchaseRepository purchasedRepository;
@Autowired
CustomerRepository customerRepository;
@Autowired
RestTemplate restTemplete;
public String purchasePolicyById(Long customerId, PurchasePolicyRequest request) {
    Customer customer = customerRepository.findById(customerId)
            .orElseThrow(() -> new RuntimeException("Customer not found"));

    Policy policy = policyServiceClient.getPolicyById(request.getPolicyId());
    if (policy == null) {
        throw new RuntimeException("Policy not found");
    }

    PurchasedPolicy purchasedPolicy = new PurchasedPolicy();
    purchasedPolicy.setCustomer(customer);
    purchasedPolicy.setPolicy(policy);
    purchasedPolicy.setPurchaseDate(LocalDateTime.now());
    purchasedPolicy.setPremium(request.getPremium());
    purchasedPolicy.setMaturityDate(request.getMaturityDate());
    purchasedPolicy.setStatus("Active");

    purchasedRepository.save(purchasedPolicy);

    return "Policy purchased successfully!";
}

}
